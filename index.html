<!DOCTYPE html>

<html>
    <head>
        <title>Greenhouse panel</title>
    </head>

    <body>
        <h1>
            Greenhouse panel
        </h1>
        <h3>Info</h3>
        <h5 id="info">
        </h5>

        <h3>Set given temperature (C)</h3>
        <form id="temperature-given-form">
            <input type="number" id="temperature-form-input" step="0.1">
        </form>

        <h3>Set given soil humidity (mV)</h3>
        <h6>Air -> more than 520 </h6>
        <h6>Dry soil -> 520 - 430</h6>
        <h6>Wet soil -> 430 - 350</h6>
        <h6>Water -> 350 - 260</h6>
        <form id="humidity-given-form">
            <input type="number" id="humidity-form-input" step="0.1">
        </form>

        <h3>Temperature</h3>
        <ol id="temperature-measurements"></ol>

        <h3>Soil humidity</h3>
        <ol id="humidity-measurements"></ol>
    </body>

    <script>
        setInterval(() => {
            reload_statistics();
            reload_temperature_measurements();
            reload_humidity_measurements();
        }, 500);

        document.getElementById("temperature-given-form").addEventListener("submit", (e) => {
            e.preventDefault();

            const formInputEl = document.getElementById("temperature-form-input");

            (async () => {
                await fetch(`/api/temperature?value=${formInputEl.value}`, {
                    method: 'POST',
                });
            })();
        })


        document.getElementById("humidity-given-form").addEventListener("submit", (e) => {
            e.preventDefault();

            const formInputEl = document.getElementById("humidity-form-input");

            (async () => {
                await fetch(`/api/humidity?value=${formInputEl.value}`, {
                    method: 'POST',
                });
            })();
        })

        async function reload_statistics() {
            const infoEl = document.getElementById("info");

            const resp = await fetch("/api/info");
            const content = await resp.text();

            infoEl.innerHTML = "";
            infoEl.insertAdjacentHTML("beforeend", content);
        }

        async function reload_temperature_measurements() {
            const measurementsEl = document.getElementById("temperature-measurements");

            const resp = await fetch("/api/temperature");
            const measurements = await resp.json();

            const content = measurements.reverse().reduce((acc, cur) => {
                acc += `<li>${cur} C</li>`;

                return acc;
            }, "");

            measurementsEl.innerHTML = "";
            measurementsEl.insertAdjacentHTML("beforeend", content);
        }

        async function reload_humidity_measurements() {
            const measurementsEl = document.getElementById("humidity-measurements");

            const resp = await fetch("/api/humidity");
            const measurements = await resp.json();

            const content = measurements.reverse().reduce((acc, cur) => {
                acc += `<li>${cur} mV</li>`;

                return acc;
            }, "");

            measurementsEl.innerHTML = "";
            measurementsEl.insertAdjacentHTML("beforeend", content);
        }
    </script>
</html>
